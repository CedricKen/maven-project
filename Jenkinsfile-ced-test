pipeline {
    agent any

    stages {

        stage('Setup parameters') {
            steps {
                script { 
                    properties([
                        parameters([
                    
                            string(
                                defaultValue: '1.0.0', 
                                name: 'ImageTag', 
                                trim: true
                            )
                        ])
                    ])
                }
            }
        }

        stage('clean') {
            agent {
        docker { image 'maven:3.8.5-openjdk-11-slim' }
            }
            steps {
                sh '''
                mvn clean
                '''
            }
        }
    
    
        stage('validate') {
            agent {
        docker { image 'maven:3.8.5-openjdk-11-slim' }
            }
            steps {
                sh'''
                mvn validate
                '''
            }
        }
    
    
        stage('compile') {
            agent {
        docker { image 'maven:3.8.5-openjdk-11-slim' }
            }
            steps {
                sh'''
                mvn compile
                '''
            }
        }
    
        stage('test ') {
            agent {
        docker { image 'maven:3.8.5-openjdk-11-slim' }
            }
            steps {
                sh'''
                mvn test 
                '''
            }
        }

       
        stage('package ') {
            agent {
        docker { image 'maven:3.8.5-openjdk-11-slim' }
            }
            steps {
                sh'''
                mvn package 
                ls -l webapp/target/
                '''
            }
        }
    
        
        stage('verify ') {
            agent {
        docker { image 'maven:3.8.5-openjdk-11-slim' }
            }
            steps {
                sh'''
                mvn verify 
                '''
            }
        }


        stage('install ') {
            agent {
        docker { image 'maven:3.8.5-openjdk-11-slim' }
            }
            steps {
               sh'''
               mvn install 
               '''
            }
        }



        stage('build') {
            
            steps {
               sh'''
               docker build -t devopseasylearning2021/cedric_0314:$ImageTag .
               '''
            }
        }



    }
}
